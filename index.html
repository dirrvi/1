import { useState } from 'react';
import { Card, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';

const questions = [
  { question: 'Столиця Франції?', options: ['Париж', 'Берлін', 'Мадрид'], answer: 'Париж' },
  { question: 'Столиця Японії?', options: ['Пекін', 'Токіо', 'Сеул'], answer: 'Токіо' },
  // Додай ще 10 питань у цьому ж форматі
];

export default function CapitalsQuizApp() {
  const [step, setStep] = useState('login');
  const [name, setName] = useState('');
  const [code, setCode] = useState('');
  const [current, setCurrent] = useState(0);
  const [answers, setAnswers] = useState([]);
  const [result, setResult] = useState(null);

  const handleLogin = () => {
    if (code === '51' && name.trim() !== '') {
      setStep('start');
    }
  };

  const handleStartQuiz = () => {
    setStep('quiz');
  };

  const handleAnswer = (option) => {
    const newAnswers = [...answers];
    newAnswers[current] = { question: questions[current].question, selected: option };
    setAnswers(newAnswers);
  };

  const handleNext = () => {
    if (current + 1 < questions.length) {
      setCurrent(current + 1);
    }
  };

  const handleFinish = () => {
    const correctCount = answers.filter((a, i) => a?.selected === questions[i].answer).length;
    setResult({ name, correct: correctCount, total: questions.length });
    setStep('result');
    // Тут можна відправити аналітику в API або базу даних
    console.log({ name, answers, correctCount });
  };

  return (
    <div className="p-6 max-w-xl mx-auto">
      {step === 'login' && (
        <Card>
          <CardContent className="space-y-4">
            <h1 className="text-xl font-bold">Розпочати тестування</h1>
            <input
              type="text"
              placeholder="Ім’я"
              className="border rounded p-2 w-full"
              value={name}
              onChange={(e) => setName(e.target.value)}
            />
            <input
              type="text"
              placeholder="Код"
              className="border rounded p-2 w-full"
              value={code}
              onChange={(e) => setCode(e.target.value)}
            />
            <Button onClick={handleLogin}>Розпочати тестування</Button>
          </CardContent>
        </Card>
      )}

      {step === 'start' && (
        <Card>
          <CardContent className="space-y-4">
            <h2 className="text-lg font-semibold">Назва тесту: Столиці світу</h2>
            <Button onClick={handleStartQuiz}>Почати</Button>
          </CardContent>
        </Card>
      )}

      {step === 'quiz' && (
        <Card>
          <CardContent className="space-y-4">
            <h2 className="text-lg font-semibold">{questions[current].question}</h2>
            {questions[current].options.map((option) => (
              <Button key={option} onClick={() => handleAnswer(option)}>{option}</Button>
            ))}
            {current + 1 < questions.length ? (
              <Button onClick={handleNext}>Далі</Button>
            ) : (
              <Button onClick={handleFinish}>Завершити тестування</Button>
            )}
          </CardContent>
        </Card>
      )}

      {step === 'result' && result && (
        <Card>
          <CardContent className="space-y-4">
            <h2 className="text-xl font-bold">Результат</h2>
            <p>Ім’я: {result.name}</p>
            <p>Правильних відповідей: {result.correct} з {result.total}</p>
          </CardContent>
        </Card>
      )}
    </div>
  );
}
