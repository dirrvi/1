<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Тестування</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f4f4f4; }
    .hidden { display: none; }
    .page { padding: 20px; max-width: 900px; margin: auto; }
    button { margin-top: 10px; padding: 10px 20px; font-size: 16px; cursor: pointer; }
    .tabs { display: flex; margin-bottom: 10px; }
    .tab { margin-right: 10px; padding: 10px 15px; background: #ddd; cursor: pointer; user-select: none; border-radius: 5px 5px 0 0; }
    .tab.active { background: #bbb; font-weight: bold; }
    .tab-content { background: white; padding: 15px; border: 1px solid #ccc; border-top: none; border-radius: 0 5px 5px 5px; min-height: 280px; }
    .question { margin-bottom: 15px; }
    .question p { margin: 0 0 5px; }
    .question label { display: block; margin-bottom: 4px; cursor: pointer; }
    table.results-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    table.results-table th, table.results-table td { border: 1px solid #ccc; padding: 8px; text-align: center; background-color: #fff; }
    .col3-green { background-color: #c9f7c2; }
    #answersModal {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      display: none; align-items: center; justify-content: center;
      overflow-y: auto; padding: 20px;
      z-index: 9999;
    }
    #answersContent {
      background: white; max-width: 800px; padding: 20px; border-radius: 8px;
      max-height: 90vh; overflow-y: auto;
      box-shadow: 0 0 15px rgba(0,0,0,0.3);
      position: relative;
    }
    #answersContent h3 {
      margin-top: 25px;
      margin-bottom: 10px;
      border-bottom: 2px solid #ccc;
      padding-bottom: 5px;
    }
    #answersContent .question-block {
      margin-bottom: 15px;
    }
    #answersContent .correct {
      color: green;
      font-weight: bold;
    }
    #answersContent .wrong {
      color: red;
      font-weight: bold;
    }
    #answersContent button.close-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      cursor: pointer;
      background: #f44336;
      border: none;
      color: white;
      font-size: 16px;
      padding: 5px 10px;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <div id="answersModal">
    <div id="answersContent">
      <button class="close-btn" onclick="closeAnswers()">Закрити</button>
      <div id="answersInner"></div>
    </div>
  </div>

  <script>
    const app = document.getElementById("app");
    const answersModal = document.getElementById("answersModal");
    const answersInner = document.getElementById("answersInner");

    let state = {
      currentPage: "rules",
      block: 1,
      subjectIndex: 0,
      answers: {
        "Українська мова": Array(12).fill(null),
        "Математика": Array(12).fill(null),
        "Історія України": Array(12).fill(null),
        "Англійська мова": Array(12).fill(null)
      }
    };

    const subjects = {
      1: ["Українська мова", "Математика"],
      2: ["Історія України", "Англійська мова"]
    };

    const questions = {
      "Українська мова": [
        { question: "Яке слово є іменником?", options: ["Бігати", "Швидко", "Книга", "Гарний"], correct: 2 },
        { question: "Виберіть прикметник:", options: ["Столик", "Великий", "Ходити", "Дружба"], correct: 1 },
        { question: "Який знак ставиться в кінці речення?", options: [".", "!", "?", ","], correct: 0 },
        { question: "Виберіть правильний наголос у слові 'вітáти':", options: ["віта́ти", "віта́ти", "віта́ти", "віта́ти"], correct: 0 },
        { question: "Як називається розділ книги?", options: ["Розділ", "Абзац", "Параграф", "Тема"], correct: 0 },
        { question: "Виберіть слово з апострофом:", options: ["Об'єкт", "Школа", "Місто", "Дім"], correct: 0 },
        { question: "Яке слово є дієсловом?", options: ["Бігти", "Великий", "Сонце", "Книга"], correct: 0 },
        { question: "Виберіть правильно написане слово:", options: ["Друзі", "Другі", "Друзi", "Друзіє"], correct: 0 },
        { question: "Що таке синонім?", options: ["Слово з протилежним значенням", "Слово з подібним значенням", "Ім'я людини", "Число"], correct: 1 },
        { question: "Виберіть спільнокореневі слова:", options: ["Вода, Водій", "Вода, Хмара", "Водій, Хмара", "Хмара, Сонце"], correct: 0 },
        { question: "Яке слово є займенником?", options: ["Я", "Дім", "Ходити", "Весна"], correct: 0 },
        { question: "Що означає слово 'Вітати'?", options: ["Привітати", "Бігти", "Говорити", "Читати"], correct: 0 }
      ],
      "Математика": [
        { question: "Скільки буде 2 + 2?", options: ["3", "4", "5", "6"], correct: 1 },
        { question: "Який результат 5 - 3?", options: ["1", "3", "2", "4"], correct: 2 },
        { question: "Обчисліть 3 × 3", options: ["6", "9", "8", "12"], correct: 1 },
        { question: "Розв’яжіть 12 ÷ 4", options: ["3", "4", "6", "2"], correct: 0 },
        { question: "Яке число є парним?", options: ["3", "7", "10", "9"], correct: 2 },
        { question: "Що таке добуток?", options: ["Сума чисел", "Різниця чисел", "Результат множення", "Частка чисел"], correct: 2 },
        { question: "Яке число йде після 14?", options: ["13", "15", "12", "16"], correct: 1 },
        { question: "Знайдіть периметр квадрата зі стороною 5", options: ["10", "15", "20", "25"], correct: 2 },
        { question: "Обчисліть 7 + 8", options: ["14", "15", "16", "17"], correct: 3 },
        { question: "Яке число є непарним?", options: ["4", "6", "9", "8"], correct: 2 },
        { question: "Яке число є більшим: 25 чи 30?", options: ["25", "30", "Обидва однакові", "Немає відповіді"], correct: 1 },
        { question: "Обчисліть 10 - 7", options: ["1", "2", "3", "4"], correct: 2 }
      ],
      "Історія України": [
        { question: "Коли проголошено незалежність України?", options: ["1918", "1991", "2000", "1985"], correct: 1 },
        { question: "Хто був гетьманом України?", options: ["Богдан Хмельницький", "Іван Франко", "Тарас Шевченко", "Леся Українка"], correct: 0 },
        { question: "Яка столиця України?", options: ["Львів", "Харків", "Київ", "Одеса"], correct: 2 },
        { question: "Коли почалась Друга світова війна?", options: ["1939", "1914", "1945", "1920"], correct: 0 },
        { question: "Хто був першим президентом України?", options: ["Віктор Ющенко", "Леонід Кравчук", "Віктор Янукович", "Петро Порошенко"], correct: 1 },
        { question: "Що таке Революція гідності?", options: ["Рух за права", "Революція 2014 року", "Війна", "Свято"], correct: 1 },
        { question: "Коли було Хрещення Київської Русі?", options: ["988", "1054", "1200", "1500"], correct: 0 },
        { question: "Хто написав «Кобзар»?", options: ["Іван Франко", "Тарас Шевченко", "Леся Українка", "Микола Гоголь"], correct: 1 },
        { question: "Яка подія відбулася в 1648 році?", options: ["Повстання Богдана Хмельницького", "Перша світова війна", "Створення УНР", "Хрещення Русі"], correct: 0 },
        { question: "Що таке Голодомор?", options: ["Голод 1932-33 років", "Свято урожаю", "Війна", "Революція"], correct: 0 },
        { question: "Хто такий Іван Мазепа?", options: ["Гетьман", "Писатель", "Політик", "Військовий"], correct: 0 },
        { question: "Яка мова є державною в Україні?", options: ["Російська", "Англійська", "Українська", "Польська"], correct: 2 }
      ],
      "Англійська мова": [
        { question: "What is the English word for 'книга'?", options: ["Book", "Pen", "Table", "Chair"], correct: 0 },
        { question: "How do you say 'Привіт' in English?", options: ["Goodbye", "Hello", "Thanks", "Please"], correct: 1 },
        { question: "Select the correct plural form: one cat, two __?", options: ["cats", "cat", "cates", "catt"], correct: 0 },
        { question: "What is the opposite of 'big'?", options: ["small", "tall", "long", "short"], correct: 0 },
        { question: "Complete the sentence: I __ a student.", options: ["is", "are", "am", "be"], correct: 2 },
        { question: "Choose the correct past tense of 'go':", options: ["goed", "went", "gone", "goes"], correct: 1 },
        { question: "Which is a color?", options: ["Dog", "Blue", "Run", "Happy"], correct: 1 },
        { question: "How do you say 'Дякую' in English?", options: ["Sorry", "Thanks", "Please", "Hello"], correct: 1 },
        { question: "Select the correct sentence:", options: ["She go to school", "She goes to school", "She going to school", "She gone to school"], correct: 1 },
        { question: "What is the English word for 'яблуко'?", options: ["Apple", "Orange", "Banana", "Grape"], correct: 0 },
        { question: "Choose the correct question word: __ is your name?", options: ["Who", "What", "Where", "When"], correct: 1 },
        { question: "Complete the sentence: They __ playing football now.", options: ["is", "are", "am", "be"], correct: 1 }
      ]
    };

    function setPage(page) {
      state.currentPage = page;
      render();
    }

    function render() {
      const { currentPage, block, subjectIndex, answers } = state;
      const subjectList = subjects[block];
      const subject = subjectList[subjectIndex];

      if (currentPage === "rules") {
        app.innerHTML = `
          <div class="page">
            <h2>Правила тестування</h2>
            <p>Ознайомтесь з інструкціями перед початком тестування.</p>
            <ul>
              <li>Кожен блок містить по 2 предмети.</li>
              <li>У кожному предметі 12 питань.</li>
              <li>Відповідайте на всі питання.</li>
              <li>Після проходження блоку можна переглянути результати.</li>
            </ul>
            <button onclick="setPage('access1')">З правилами ознайомився/лась</button>
          </div>
        `;
      }
      else if (currentPage === "access1" || currentPage === "access2") {
        const blockNum = currentPage === "access1" ? 1 : 2;
        app.innerHTML = `
          <div class="page">
            <h2>Блок ${blockNum} - Початок тестування</h2>
            <p>Введіть код доступу для блоку ${blockNum}:</p>
            <input type="password" id="accessCodeInput" placeholder="Код доступу" />
            <br/>
            <button onclick="checkAccessCode()">Почати тестування</button>
          </div>
        `;
      }
      else if (currentPage === "test") {
        // Вкладки предметів
        let tabsHTML = subjectList.map((subj, idx) => `
          <div class="tab ${idx === subjectIndex ? "active" : ""}" onclick="switchSubject(${idx})">${subj}</div>
        `).join("");

        // Вміст з питаннями для поточного предмету
        const currentQuestions = questions[subject];
        const userAnswers = answers[subject];

        let questionsHTML = currentQuestions.map((q, i) => {
          const optionsHTML = q.options.map((opt, idx) => {
            const checked = userAnswers[i] === idx ? "checked" : "";
            return `
              <label>
                <input type="radio" name="q${i}" value="${idx}" ${checked} onchange="answerQuestion('${subject}', ${i}, ${idx})" />
                ${opt}
              </label>
            `;
          }).join("");
          return `
            <div class="question">
              <p><b>Питання ${i+1}:</b> ${q.question}</p>
              ${optionsHTML}
            </div>
          `;
        }).join("");

        app.innerHTML = `
          <div class="page">
            <h2>Тестування - Блок ${block}, предмет: ${subject}</h2>
            <div class="tabs">${tabsHTML}</div>
            <div class="tab-content">${questionsHTML}</div>
            <button onclick="prevSubject()">Попередній предмет</button>
            <button onclick="nextSubject()">Наступний предмет</button>
            <button onclick="finishBlock()">Завершити блок</button>
          </div>
        `;
      }
      else if (currentPage === "results") {
        // Підрахунок балів для кожного предмета
        function countCorrect(subj) {
          let correct = 0;
          questions[subj].forEach((q, i) => {
            if (answers[subj][i] === q.correct) correct++;
          });
          return correct;
        }

        let resultsRows = [];
        for(let b = 1; b <= 2; b++) {
          for(const subj of subjects[b]) {
            resultsRows.push(`
              <tr>
                <td>${b}</td>
                <td>${subj}</td>
                <td class="col3-green">${countCorrect(subj)} / 12</td>
              </tr>
            `);
          }
        }

        app.innerHTML = `
          <div class="page">
            <h2>Результати тестування</h2>
            <table class="results-table">
              <thead>
                <tr><th>Блок</th><th>Предмет</th><th>Правильних відповідей</th></tr>
              </thead>
              <tbody>
                ${resultsRows.join("")}
              </tbody>
            </table>
            <button onclick="viewAnswers()">Переглянути відповіді</button>
            <button onclick="restart()">Почати знову</button>
          </div>
        `;
      }
    }

    function checkAccessCode() {
      const input = document.getElementById("accessCodeInput");
      const val = input.value.trim();
      if ((state.currentPage === "access1" && val === "code1") || (state.currentPage === "access2" && val === "code2")) {
        state.currentPage = "test";
        // Якщо це другий блок - обнулити subjectIndex
        state.subjectIndex = 0;
        render();
      } else {
        alert("Неправильний код доступу!");
      }
    }

    function switchSubject(idx) {
      state.subjectIndex = idx;
      render();
    }

    function prevSubject() {
      if(state.subjectIndex > 0) {
        state.subjectIndex--;
        render();
      }
    }

    function nextSubject() {
      if(state.subjectIndex < subjects[state.block].length - 1) {
        state.subjectIndex++;
        render();
      }
    }

    function answerQuestion(subject, questionIndex, optionIndex) {
      state.answers[subject][questionIndex] = optionIndex;
    }

    function finishBlock() {
      // Перевірити, чи відповіли на всі питання поточного блоку
      const blockSubjects = subjects[state.block];
      for(const subj of blockSubjects) {
        if(state.answers[subj].some(ans => ans === null)) {
          alert(`Будь ласка, дайте відповіді на всі питання з предмету "${subj}"`);
          return;
        }
      }
      if(state.block === 1) {
        state.block = 2;
        state.currentPage = "access2";
        state.subjectIndex = 0;
        render();
      } else {
        state.currentPage = "results";
        render();
      }
    }

    function viewAnswers() {
      // Відкрити модальне вікно з відповідями
      answersInner.innerHTML = "";

      for(let b=1; b<=2; b++) {
        for(const subj of subjects[b]) {
          const qList = questions[subj];
          const userAns = state.answers[subj];

          let blockHTML = `<h3>Блок ${b} - ${subj}</h3>`;
          qList.forEach((q, i) => {
            const correctIdx = q.correct;
            const userIdx = userAns[i];
            const isCorrect = userIdx === correctIdx;

            blockHTML += `
              <div class="question-block">
                <p><b>Питання ${i+1}:</b> ${q.question}</p>
                <p>Ваш варіант: <span class="${isCorrect ? "correct" : "wrong"}">${userIdx !== null ? q.options[userIdx] : "<i>немає відповіді</i>"}</span></p>
                <p>Правильна відповідь: <b>${q.options[correctIdx]}</b></p>
              </div>
            `;
          });
          answersInner.innerHTML += blockHTML;
        }
      }

      answersModal.style.display = "flex";
    }

    function closeAnswers() {
      answersModal.style.display = "none";
    }

    function restart() {
      // Скинути стан і повернутися на початок
      state = {
        currentPage: "rules",
        block: 1,
        subjectIndex: 0,
        answers: {
          "Українська мова": Array(12).fill(null),
          "Математика": Array(12).fill(null),
          "Історія України": Array(12).fill(null),
          "Англійська мова": Array(12).fill(null)
        }
      };
      render();
    }

    render();
  </script>
</body>
</html>
