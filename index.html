<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Тестування</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      background: #f4f4f4;
      color: #000;
    }
    .page {
      max-width: 800px;
      margin: 30px auto;
      padding: 20px;
      background: #fff;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 15px;
      cursor: pointer;
    }
    .tabs {
      display: flex;
      margin-bottom: 10px;
      user-select: none;
    }
    .tab {
      padding: 10px 15px;
      background: #ddd;
      margin-right: 10px;
      cursor: pointer;
      border-radius: 3px 3px 0 0;
    }
    .tab.active {
      background: #bbb;
      font-weight: bold;
    }
    .tab-content {
      border: 1px solid #bbb;
      padding: 15px;
      border-radius: 0 3px 3px 3px;
      background: #fff;
    }
    .question {
      margin-bottom: 15px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
      background: #fff;
    }
    .col3-green {
      background-color: #c9f7c2 !important;
    }
    .answer-correct {
      color: green;
      font-weight: bold;
    }
    .answer-wrong {
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body>

<div id="app" class="page"></div>

<script>
(() => {
  // === Дані ===
  const questions = {
    "Українська мова": [
      { question: "Обери правильне твердження про українську мову.", options: ["Це слов'янська мова", "Це романська мова", "Це германська мова", "Це мова з Африки"], correct: 0 },
      { question: "Який з цих слів є іменником?", options: ["бігти", "книга", "швидко", "весело"], correct: 1 },
      { question: "Оберіть правильне речення.", options: ["Я люблю читати книгу", "Читати люблю я книгу", "Люблю я книгу читати", "Книгу я люблю читати"], correct: 0 },
      { question: "Визнач, де помилка: 'Він пішов в школу вчасно'.", options: ["помилка у слові 'в'", "помилка у слові 'школу'", "помилка у слові 'вчасно'", "помилки немає"], correct: 0 },
      { question: "Як правильно написати слово?", options: ["світло", "світло", "світло", "світло"], correct: 0 },
      { question: "Який відмінок у слові 'мами'?", options: ["Родовий", "Називний", "Знахідний", "Давальний"], correct: 0 }
    ],
    "Математика": [
      { question: "Скільки буде 5 + 3?", options: ["7", "8", "9", "6"], correct: 1 },
      { question: "Який результат 7 + 8?", options: ["14", "15", "16", "17"], correct: 1 },
      { question: "Що таке квадрат числа 4?", options: ["8", "16", "12", "20"], correct: 1 },
      { question: "Як називається трикутник з усіма рівними сторонами?", options: ["Рівнобедрений", "Рівносторонній", "Прямокутний", "Тупокутний"], correct: 1 },
      { question: "Який результат 10 - 7?", options: ["3", "2", "4", "5"], correct: 0 },
      { question: "Обери правильне твердження: 6 * 0 = ?", options: ["0", "6", "1", "Не визначено"], correct: 0 }
    ],
    "Історія України": [
      { question: "Коли була прийнята Конституція України?", options: ["1996", "1991", "2000", "1989"], correct: 0 },
      { question: "Хто перший президент України?", options: ["Кравчук", "Ющенко", "Кучма", "Янукович"], correct: 0 },
      { question: "Яка столиця України?", options: ["Львів", "Київ", "Харків", "Одеса"], correct: 1 },
      { question: "Яка війна була в Україні у 2014?", options: ["Світова", "Громадянська", "Війна на Донбасі", "Революція"], correct: 2 },
      { question: "Який рік отримання незалежності України?", options: ["1990", "1991", "1992", "1993"], correct: 1 },
      { question: "Хто автор Гімну України?", options: ["Шевченко", "Котляревський", "Вербицький", "Франко"], correct: 2 }
    ],
    "Англійська мова": [
      { question: "What is the English word for 'книга'?", options: ["Book", "Pen", "Table", "Chair"], correct: 0 },
      { question: "Choose the correct form: She ___ a cat.", options: ["have", "has", "had", "is"], correct: 1 },
      { question: "What is the plural of 'child'?", options: ["childs", "children", "childes", "child"], correct: 1 },
      { question: "Translate: 'Доброго ранку!'", options: ["Good night", "Good morning", "Good evening", "Good afternoon"], correct: 1 },
      { question: "How do you say 'дякую' in English?", options: ["Thanks", "Please", "Sorry", "Hello"], correct: 0 },
      { question: "Choose the correct verb: They ___ playing now.", options: ["is", "are", "was", "be"], correct: 1 }
    ],
  };

  // === Стан ---
  const state = {
    page: "rules",
    block: 1,
    subjectIndex: 0,
    answers: {
      "Українська мова": Array(6).fill(null),
      "Математика": Array(6).fill(null),
      "Історія України": Array(6).fill(null),
      "Англійська мова": Array(6).fill(null),
    }
  };

  const subjectsByBlock = {
    1: ["Українська мова", "Математика"],
    2: ["Історія України", "Англійська мова"]
  };

  // --- Елементи ---
  const app = document.getElementById("app");

  // --- Функції ---
  function render() {
    if(state.page === "rules") {
      app.innerHTML = `
        <h1>Правила тестування</h1>
        <p>Ласкаво просимо! Ви проходите тестування з 4 предметів, розбитих на 2 блоки.</p>
        <h3>Як користуватись:</h3>
        <ul>
          <li>Ознайомтесь з правилами і натисніть "З правилами ознайомився/лась".</li>
          <li>Введіть код доступу (перший блок — 54, другий блок — 29).</li>
          <li>У кожному блоці обирайте предмет через вкладки і відповідайте на питання.</li>
          <li>Після завершення блоку натисніть "Завершити тестування" і підтвердіть.</li>
          <li>Після першого блоку ви побачите результати і кнопку для переходу до другого блоку.</li>
          <li>Після другого блоку отримаєте підсумкові результати та зможете переглянути відповіді.</li>
        </ul>
        <button onclick="goToAccess()">З правилами ознайомився/лась</button>
      `;
    }
    else if(state.page === "access") {
      app.innerHTML = `
        <h2>Введіть код доступу для блоку ${state.block}</h2>
        <input type="text" id="accessCode" placeholder="Код доступу" />
        <button onclick="checkAccess()">Перейти до блоку</button>
      `;
    }
    else if(state.page === "test") {
      const subjects = subjectsByBlock[state.block];
      const activeSubject = subjects[state.subjectIndex];

      // Вкладки
      const tabs = subjects.map((s,i) =>
        `<div class="tab${i === state.subjectIndex ? " active" : ""}" onclick="switchTab(${i})">${s}</div>`
      ).join('');

      // Питання
      const qList = questions[activeSubject];
      let qHTML = "";
      qList.forEach((q,i) => {
        const userAns = state.answers[activeSubject][i];
        qHTML += `<div class="question">
          <p><strong>Питання ${i+1}:</strong> ${q.question}</p>
          ${q.options.map((opt, idx) =>
            `<label><input type="radio" name="${activeSubject}-q${i}" value="${idx}" 
            ${userAns === idx ? "checked" : ""} onchange="saveAnswer('${activeSubject}', ${i}, ${idx})" />
            ${opt}</label><br>`
          ).join('')}
        </div>`;
      });

      app.innerHTML = `
        <h2>Блок ${state.block} — ${activeSubject}</h2>
        <div class="tabs">${tabs}</div>
        <div class="tab-content">${qHTML}</div>
        <button onclick="finishBlock()">Завершити тестування</button>
      `;
    }
    else if(state.page === "blockResult") {
      // Таблиця результатів після першого блоку
      let rows = "";
      const subjectsAll = ["Українська мова", "Математика", "Історія України", "Англійська мова"];

      subjectsAll.forEach(subj => {
        const answeredCount = state.answers[subj].filter(a => a !== null).length;
        let col3 = "";
        if(state.block === 1) {
          if(subj === "Історія України" || subj === "Англійська мова") {
            col3 = "До виконання не приступив";
          }
        }
        else if(state.block === 2) {
          const correct = countCorrect(subj);
          col3 = `${correct} / 6`;
        }
        rows += `<tr>
          <td>${subj}</td>
          <td>${answeredCount} / 6</td>
          <td class="${state.block === 2 ? 'col3-green' : ''}">${col3}</td>
        </tr>`;
      });

      app.innerHTML = `
        <h2>Результати після блоку ${state.block}</h2>
        <table>
          <thead>
            <tr><th>Предмет</th><th>Відповідей</th><th>Результат</th></tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
        ${state.block === 1
          ? `<button onclick="goToNextBlock()">Перейти до другого блоку</button>`
          : `<button onclick="showAnswers()">Переглянути відповіді</button>`
        }
      `;
    }
    else if(state.page === "allAnswers") {
      // Показати всі питання і відповіді
      let html = `<h2>Відповіді на всі тести</h2>`;
      for(const subj of ["Українська мова", "Математика", "Історія України", "Англійська мова"]) {
        html += `<h3>${subj}</h3>`;
        questions[subj].forEach((q,i) => {
          const userAns = state.answers[subj][i];
          const correct = q.correct;
          const isCorrect = userAns === correct;
          html += `<p><b>Питання ${i+1}:</b> ${q.question}</p>`;
          html += `<p>Ваша відповідь: <span class="${isCorrect ? "answer-correct" : "answer-wrong"}">${userAns !== null ? q.options[userAns] : "Відповідь відсутня"}</span></p>`;
          html += `<p>Правильна відповідь: ${q.options[correct]}</p><hr>`;
        });
      }
      html += `<button onclick="restart()">Почати з початку</button>`;
      app.innerHTML = html;
    }
  }

  function goToAccess() {
    state.page = "access";
    render();
  }

  function checkAccess() {
    const codeInput = document.getElementById("accessCode");
    const code = codeInput.value.trim();
    if(state.block === 1 && code === "54") {
      state.page = "test";
      state.subjectIndex = 0;
      render();
    }
    else if(state.block === 2 && code === "29") {
      state.page = "test";
      state.subjectIndex = 0;
      render();
    }
    else {
      alert("Невірний код доступу.");
    }
  }

  function switchTab(i) {
    state.subjectIndex = i;
    render();
  }

  function saveAnswer(subject, qIndex, optionIndex) {
    state.answers[subject][qIndex] = optionIndex;
  }

  function finishBlock() {
    if(confirm("Ви точно хочете завершити роботу над тестуванням?")) {
      state.page = "blockResult";
      render();
    }
  }

  function countCorrect(subject) {
    let correctCount = 0;
    questions[subject].forEach((q,i) => {
      if(state.answers[subject][i] === q.correct) correctCount++;
    });
    return correctCount;
  }

  function goToNextBlock() {
    state.block = 2;
    state.page = "access";
    render();
  }

  function showAnswers() {
    state.page = "allAnswers";
    render();
  }

  function restart() {
    // Очистити відповіді і повернутись на початок
    for(let subj in state.answers) {
      state.answers[subj] = Array(6).fill(null);
    }
    state.block = 1;
    state.page = "rules";
    render();
  }

  // --- Старт ---
  render();

  // Для доступу з HTML
  window.goToAccess = goToAccess;
  window.checkAccess = checkAccess;
  window.switchTab = switchTab;
  window.saveAnswer = saveAnswer;
  window.finishBlock = finishBlock;
  window.goToNextBlock = goToNextBlock;
  window.showAnswers = showAnswers;
  window.restart = restart;

})();
</script>

</body>
</html>
